"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[12],{8632:(e,t,r)=>{let n;r.d(t,{$:()=>g,MusicProvider:()=>w});var a=r(95155),i=r(12115),l=r(87481),o=r(198);function s(){return n||(n=(0,o.P2)("lightaudio-db",1,{upgrade(e){e.createObjectStore("keyval")}})),n}async function d(e){return(await s()).get("keyval",e)}async function c(e,t){let r=await s();await r.put("keyval",t,e)}async function u(e){let t=await s();await t.delete("keyval",e)}var f=r(47906),p=r(50402);let g=(0,i.createContext)(null),v=null;async function y(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={mode:"read"};if(t)try{return await e.requestPermission(r)==="granted"}catch(e){return console.error("Permission request failed, likely not triggered by a user gesture.",e),!1}return"granted"===await e.queryPermission(r)}async function m(e,t){let r=e;try{for(let e=0;e<t.length-1;e++)r=await r.getDirectoryHandle(t[e]);let e=t[t.length-1];return await r.getFileHandle(e)}catch(e){return console.error("Error getting file handle for path: ".concat(t.join("/")),e),null}}let h=e=>{let t=[...e];for(let e=t.length-1;e>0;e--){let r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t},S=e=>{try{let t={currentSongId:e.currentSongId,queueIds:e.queueIds,originalQueueIds:e.originalQueueIds,isShuffled:e.isShuffled,repeatMode:e.repeatMode,progress:e.progress,volume:e.volume};localStorage.setItem("playbackState",JSON.stringify(t))}catch(e){console.error("Failed to save playback state",e)}},b=()=>{try{let e=localStorage.getItem("playbackState");if(e)return JSON.parse(e);return null}catch(e){return console.error("Failed to load playback state",e),null}},w=e=>{let{children:t}=e,[n,o]=(0,i.useState)([]),[s,w]=(0,i.useState)([]),[I,E]=(0,i.useState)(null),[k,A]=(0,i.useState)(null),[T,L]=(0,i.useState)([]),[R,x]=(0,i.useState)([]),[O,C]=(0,i.useState)(!1),[P,M]=(0,i.useState)(!0),[_,D]=(0,i.useState)(!1),[U,N]=(0,i.useState)(!1),[j,F]=(0,i.useState)(!1),[H,Q]=(0,i.useState)("none"),q=(0,i.useRef)(null),B=(0,i.useRef)(null),{toast:z}=(0,l.dj)(),J=(0,f.a)(),[W,V]=(0,i.useState)(null),$=(0,i.useRef)(null),X=(0,i.useRef)(null),G=(0,i.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!B.current||_)return;D(!0),t&&o([]),await c("directoryHandle",e),v=e,C(!0);let r=t?[]:await d("songs")||[];B.current.postMessage({type:"SCAN_START",payload:{directoryHandle:e,existingSongIds:r.map(e=>e.id)}}),t&&!J&&M(!1)},[_,J]);(0,i.useEffect)(()=>(B.current=new Worker(r.tu(new URL(r.p+r.u(494),r.b))),B.current.onmessage=e=>{let{type:t,payload:r}=e.data;if("SCAN_COMPLETE"===t){let{newSongs:e,removedSongIds:t}=r;e.length>0&&(o(t=>{let r=new Set(t.map(e=>e.id)),n=e.filter(e=>!r.has(e.id));if(0===n.length)return t;let a=[...t,...n];return c("songs",a),a}),z({title:"Library Updated",description:"Found ".concat(e.length," new song(s).")})),t.length>0&&(o(e=>{let r=e.filter(e=>!t.includes(e.id));return c("songs",r),r}),z({title:"Library Cleaned",description:"Removed ".concat(t.length," unavailable song(s).")})),D(!1)}else"SCAN_ERROR"===t&&(console.error("Scan worker error:",r.error),z({title:"Scan Error",description:"Could not scan the music folder.",variant:"destructive"}),D(!1))},()=>{var e;null==(e=B.current)||e.terminate()}),[z]);let K=(0,i.useCallback)(()=>{if(q.current){var e;(null==(e=$.current)?void 0:e.state)==="suspended"&&$.current.resume(),q.current.play().catch(e=>{"AbortError"!==e.name&&console.error("Playback failed",e)})}},[]),Y=(0,i.useCallback)(()=>{q.current&&q.current.pause()},[]),Z=(0,i.useCallback)(async(e,t)=>{var r;if(!v||!q.current)return;let a=q.current;(null==(r=$.current)?void 0:r.state)==="suspended"&&await $.current.resume();let i=await m(v,e.path);if(!i)return void z({title:"File not found",description:"Could not find the audio file for this song.",variant:"destructive"});let l=await i.getFile();k&&URL.revokeObjectURL(k);let o=URL.createObjectURL(l);E(e),A(o);let s=()=>{a.play().catch(e=>{"AbortError"!==e.name&&console.error("Playback initiation failed",e)}),a.removeEventListener("canplaythrough",s)};a.addEventListener("canplaythrough",s),a.src=o,a.load();let d=t||n.slice(n.findIndex(t=>t.id===e.id));if(x(d),j){let t=h(d.filter(t=>t.id!==e.id));L([e,...t])}else L(d)},[n,j,k,z]),ee=(0,i.useCallback)(()=>{if(!I)return;if("one"===H&&q.current){q.current.currentTime=0,K();return}let e=T.findIndex(e=>e.id===I.id);if(-1===e)return;let t=e+1;if(t>=T.length)if("all"===H)t=0;else{E(null),q.current&&(q.current.src="");return}Z(T[t],T)},[I,T,H,Z,K]);(0,i.useEffect)(()=>{(()=>{if(q.current)return;let e=new Audio;e.id="audio-player-core",document.body.appendChild(e),q.current=e,e.addEventListener("play",()=>N(!0)),e.addEventListener("pause",()=>N(!1)),e.addEventListener("ended",()=>ee());try{let t=new(window.AudioContext||window.webkitAudioContext);$.current=t;let r=t.createAnalyser();r.fftSize=256,V(r);let n=t.createMediaElementSource(e);X.current=n,n.connect(r),r.connect(t.destination)}catch(e){console.error("Web Audio API is not supported in this browser",e)}})();let e=()=>{var e;(null==(e=$.current)?void 0:e.state)==="suspended"&&$.current.resume()};return document.addEventListener("click",e,{once:!0}),()=>{let t=q.current;t&&(t.removeEventListener("play",()=>N(!0)),t.removeEventListener("pause",()=>N(!1)),t.removeEventListener("ended",ee)),document.removeEventListener("click",e),k&&URL.revokeObjectURL(k)}},[ee,k]);let et=(0,i.useCallback)(()=>{if(!I||0===T.length)return;if(q.current&&q.current.currentTime>3){q.current.currentTime=0;return}let e=T.findIndex(e=>e.id===I.id);e>0&&Z(T[e-1],T)},[I,T,Z]);(0,i.useEffect)(()=>{if("mediaSession"in navigator){if(I){let e=I.coverArt?[{src:I.coverArt,sizes:"512x512",type:"image/jpeg"}]:[];navigator.mediaSession.metadata=new MediaMetadata({title:I.title,artist:I.artist,album:I.album,artwork:e})}navigator.mediaSession.playbackState=U?"playing":"paused"}},[I,U]),(0,i.useEffect)(()=>{"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",K),navigator.mediaSession.setActionHandler("pause",Y),navigator.mediaSession.setActionHandler("previoustrack",et),navigator.mediaSession.setActionHandler("nexttrack",ee))},[K,Y,et,ee]),(0,i.useEffect)(()=>{let e=async()=>{M(!0);try{let[e,t,r,n]=await Promise.all([d("directoryHandle"),d("playlists"),d("songs"),b()]);if(t&&w(t),r&&o(r),e&&(v=e,await y(e,!1)?(C(!0),J||G(e,!1)):C(!1)),n&&r&&r.length>0){let{currentSongId:e,queueIds:t,originalQueueIds:a,isShuffled:i,repeatMode:l,progress:o,volume:s}=n,d=(null==t?void 0:t.map(e=>r.find(t=>t.id===e)).filter(Boolean))||[],c=(null==a?void 0:a.map(e=>r.find(t=>t.id===e)).filter(Boolean))||[],u=r.find(t=>t.id===e)||null;if(L(d),x(c),E(u),F(i||!1),Q(l||"none"),q.current){if(u&&v&&await y(v)){let e=await m(v,u.path);if(e){let t=await e.getFile();k&&URL.revokeObjectURL(k);let r=URL.createObjectURL(t);A(r),q.current.src=r,q.current.currentTime=o||0}}q.current.volume=s||.5}}}catch(e){console.error("Could not retrieve data from IndexedDB",e)}finally{M(!1)}};void 0!==J&&e()},[J]),(0,i.useEffect)(()=>{let e=()=>{if(q.current){var e,t;S({currentSongId:null==I?void 0:I.id,queueIds:T.map(e=>e.id),originalQueueIds:R.map(e=>e.id),isShuffled:j,repeatMode:H,progress:null==(e=q.current)?void 0:e.currentTime,volume:null==(t=q.current)?void 0:t.volume})}},t=setInterval(e,5e3);return window.addEventListener("beforeunload",e),()=>{clearInterval(t),window.removeEventListener("beforeunload",e),e()}},[I,T,R,j,H]);let er=(0,i.useCallback)(async()=>{v?await y(v,!0)?(z({title:"Rescanning Library",description:"Looking for new music in the background."}),await G(v,!1)):z({title:"Permission Denied",description:"Permission to access the folder was denied.",variant:"destructive"}):z({title:"No Folder Selected",description:"Please select a music folder first.",variant:"destructive"})},[G,z]),en=(0,i.useCallback)(async()=>{o([]),E(null),L([]),x([]),w([]),C(!1),v=null,await u("directoryHandle"),await u("playlists"),await u("songs"),localStorage.removeItem("playbackState"),q.current&&(q.current.src="")},[]),ea=async e=>{let t=[...s,{id:"playlist-".concat(Date.now()),name:e,songIds:[],createdAt:new Date().toISOString()}];w(t),await c("playlists",t),z({title:"Playlist Created",description:'"'.concat(e,'" has been created.')})},ei=async(e,t)=>{let r="",n=s.map(n=>n.id===e?(r=n.name,{...n,name:t}):n);w(n),await c("playlists",n),z({title:"Playlist Renamed",description:'"'.concat(r,'" is now "').concat(t,'".')})},el=async e=>{let t=s.find(t=>t.id===e);if(t){let r=s.filter(t=>t.id!==e);w(r),await c("playlists",r),z({title:"Playlist Deleted",description:'"'.concat(t.name,'" has been deleted.'),variant:"destructive"})}},eo=async(e,t)=>{let r="",n=s.find(t=>t.id===e);if(!n)return;if(n.songIds.includes(t))return void z({title:"Song Already in Playlist",description:"This song is already in the selected playlist."});let a=s.map(n=>n.id===e?(r=n.name,{...n,songIds:[...n.songIds,t]}):n);w(a),await c("playlists",a),z({title:"Song Added",description:'Added to "'.concat(r,'".')})},es=async(e,t)=>{let r=s.map(r=>r.id===e?{...r,songIds:r.songIds.filter(e=>e!==t)}:r);w(r),await c("playlists",r)},ed=async(e,t,r)=>{w(n=>{let a=n.findIndex(t=>t.id===e);if(-1===a)return n;let i=n[a],l=(0,p.be)(i.songIds,t,r),o={...i,songIds:l},s=[...n];return s[a]=o,c("playlists",s),s})};return(0,a.jsx)(g.Provider,{value:{songs:n,playlists:s,createPlaylist:ea,renamePlaylist:ei,deletePlaylist:el,addSongToPlaylist:eo,removeSongFromPlaylist:es,reorderPlaylist:ed,getPlaylistSongs:e=>{let t=s.find(t=>t.id===e);return t?t.songIds.map(e=>n.find(t=>t.id===e)).filter(Boolean):[]},currentSong:I,queue:T,originalQueue:R,playSong:Z,playNextSong:ee,playPreviousSong:et,addToQueue:e=>{L(t=>[...t,e]),R.find(t=>t.id===e.id)||x(t=>[...t,e])},removeFromQueue:e=>{L(t=>t.filter(t=>t.id!==e)),x(t=>t.filter(t=>t.id!==e))},clearQueue:()=>{I?L(T.filter(e=>e.id===I.id)):(L([]),x([])),z({title:"Queue Cleared",description:"The 'Up Next' list has been cleared."})},reorderQueue:(e,t)=>{L(r=>(0,p.be)(r,e,t))},loadMusic:e=>G(e,!0),rescanMusic:er,clearLibrary:en,exportData:()=>{let e=new Blob([JSON.stringify({playlists:s},null,2)],{type:"application/json"}),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download="lightaudio_backup_".concat(new Date().toISOString().split("T")[0],".txt"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)},importData:e=>{let t=new FileReader;t.onload=async e=>{try{var t;let r=null==(t=e.target)?void 0:t.result,n=JSON.parse(r);if(n.playlists&&Array.isArray(n.playlists))w(n.playlists),await c("playlists",n.playlists),z({title:"Import Successful",description:"Restored ".concat(n.playlists.length," playlists.")});else throw Error("Invalid file format.")}catch(e){console.error("Error importing data:",e),z({title:"Import Failed",description:"The selected file is not a valid backup file.",variant:"destructive"})}},t.readAsText(e)},hasAccess:O,isLoading:P,isScanning:_,isPlaying:U,audioRef:q,analyser:W,play:K,pause:Y,isShuffled:j,repeatMode:H,toggleShuffle:()=>{F(e=>{let t=!e;if(!I)return t;if(t){let e=T.find(e=>e.id===I.id);if(!e)return t;L([e,...h(T.filter(e=>e.id!==I.id))])}else -1!==R.findIndex(e=>e.id===I.id)?L([...R]):L([I,...R.filter(e=>e.id!==I.id)]);return t})},toggleRepeat:()=>{Q(e=>"none"===e?"all":"all"===e?"one":"none")}},children:t})}},30285:(e,t,r)=>{r.d(t,{$:()=>d,r:()=>s});var n=r(95155),a=r(12115),i=r(66634),l=r(74466),o=r(59434);let s=(0,l.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=a.forwardRef((e,t)=>{let{className:r,variant:a,size:l,asChild:d=!1,...c}=e,u=d?i.DX:"button";return(0,n.jsx)(u,{className:(0,o.cn)(s({variant:a,size:l,className:r})),ref:t,...c})});d.displayName="Button"},47906:(e,t,r)=>{r.d(t,{a:()=>a});var n=r(12115);function a(){let[e,t]=n.useState(void 0);return n.useEffect(()=>{let e=window.matchMedia("(max-width: ".concat(767,"px)")),r=()=>{t(window.innerWidth<768)};return e.addEventListener("change",r),t(window.innerWidth<768),()=>e.removeEventListener("change",r)},[]),!!e}},59434:(e,t,r)=>{r.d(t,{a:()=>l,cn:()=>i});var n=r(52596),a=r(39688);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.QP)((0,n.$)(t))}function l(e){if(isNaN(e)||e<0)return"0:00";let t=Math.floor(e/60),r=Math.floor(e%60);return"".concat(t,":").concat(r.toString().padStart(2,"0"))}},87481:(e,t,r)=>{r.d(t,{dj:()=>f});var n=r(12115);let a=0,i=new Map,l=e=>{if(i.has(e))return;let t=setTimeout(()=>{i.delete(e),c({type:"REMOVE_TOAST",toastId:e})},1e6);i.set(e,t)},o=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?l(r):e.toasts.forEach(e=>{l(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},s=[],d={toasts:[]};function c(e){d=o(d,e),s.forEach(e=>{e(d)})}function u(e){let{...t}=e,r=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),n=()=>c({type:"DISMISS_TOAST",toastId:r});return c({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||n()}}}),{id:r,dismiss:n,update:e=>c({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function f(){let[e,t]=n.useState(d);return n.useEffect(()=>(s.push(t),()=>{let e=s.indexOf(t);e>-1&&s.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>c({type:"DISMISS_TOAST",toastId:e})}}}}]);